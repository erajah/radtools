<!DOCTYPE html>
<html>
<head>
  <title>Kidney Size Percentile Calculator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    input, select { margin: 0.5rem 0; padding: 0.5rem; font-size: 1rem; }
  </style>
</head>
<body>
  <h1>Kidney Size Percentile Calculator</h1>

  <label>Age: <input type="number" id="age" min="0"></label><br>
  <label>Sex:
    <select id="sex">
      <option value="M">Male</option>
      <option value="F">Female</option>
    </select>
  </label><br>
  <label>Kidney Size (cm): <input type="number" step="0.1" id="size"></label><br>
  <button onclick="calculate()">Calculate</button>

  <h2 id="output"></h2>
  <canvas id="chart" width="400" height="200"></canvas>

  <script>
    const normativeData = [
      { age: 1, sex: "M", p2_5: 54.6, p10: 58.1, p25: 61.4, p50: 65.2, p75: 69.1, p90: 72.7, p97_5: 76.8 },
      { age: 1, sex: "F", p2_5: 51.6, p10: 55.9, p25: 59.8, p50: 64.3, p75: 68.9, p90: 73, p97_5: 77.8 },
      { age: 2, sex: "M", p2_5: 57.7, p10: 61.4, p25: 64.8, p50: 68.7, p75: 72.8, p90: 76.5, p97_5: 80.9 },
      { age: 2, sex: "F", p2_5: 55.4, p10: 59.8, p25: 63.8, p50: 68.4, p75: 73.1, p90: 77.5, p97_5: 82.4 },
      { age: 3, sex: "M", p2_5: 60.9, p10: 64.8, p25: 68.4, p50: 72.5, p75: 76.8, p90: 80.8, p97_5: 85.4 },
      { age: 3, sex: "F", p2_5: 58.4, p10: 62.9, p25: 67, p50: 71.7, p75: 76.6, p90: 81.1, p97_5: 86.2 },
      { age: 4, sex: "M", p2_5: 64.5, p10: 68.5, p25: 72.2, p50: 76.5, p75: 81, p90: 85.2, p97_5: 90 },
      { age: 4, sex: "F", p2_5: 62.3, p10: 66.8, p25: 71, p50: 75.8, p75: 80.8, p90: 85.4, p97_5: 90.8 },
      { age: 5, sex: "M", p2_5: 67.4, p10: 71.5, p25: 75.3, p50: 79.7, p75: 84.3, p90: 88.6, p97_5: 93.7 },
      { age: 5, sex: "F", p2_5: 65.3, p10: 69.8, p25: 74, p50: 78.9, p75: 83.9, p90: 88.6, p97_5: 94.1 },
      { age: 6, sex: "M", p2_5: 70.4, p10: 74.5, p25: 78.5, p50: 83, p75: 87.8, p90: 92.2, p97_5: 97.4 },
      { age: 6, sex: "F", p2_5: 67.9, p10: 72.4, p25: 76.7, p50: 81.6, p75: 86.7, p90: 91.5, p97_5: 97 },
      { age: 7, sex: "M", p2_5: 73, p10: 77.3, p25: 81.3, p50: 85.9, p75: 90.8, p90: 95.3, p97_5: 100.7 },
      { age: 7, sex: "F", p2_5: 71.2, p10: 75.7, p25: 80, p50: 84.9, p75: 90.1, p90: 94.9, p97_5: 100.5 },
      { age: 8, sex: "M", p2_5: 76, p10: 80.4, p25: 84.4, p50: 89.2, p75: 94.2, p90: 98.9, p97_5: 104.4 },
      { age: 8, sex: "F", p2_5: 74.1, p10: 78.7, p25: 82.9, p50: 87.8, p75: 93, p90: 97.8, p97_5: 103.5 },
      { age: 9, sex: "M", p2_5: 78, p10: 82.4, p25: 86.5, p50: 91.3, p75: 96.4, p90: 101.1, p97_5: 106.7 },
      { age: 9, sex: "F", p2_5: 77.1, p10: 81.6, p25: 85.8, p50: 90.8, p75: 96, p90: 100.9, p97_5: 106.7 },
      { age: 10, sex: "M", p2_5: 80.5, p10: 85, p25: 89.3, p50: 94.2, p75: 99.4, p90: 104.4, p97_5: 110.2 },
      { age: 10, sex: "F", p2_5: 79.4, p10: 83.9, p25: 88.1, p50: 93.1, p75: 98.3, p90: 103.3, p97_5: 109.1 },
      { age: 11, sex: "M", p2_5: 83.1, p10: 87.6, p25: 91.9, p50: 96.9, p75: 102.2, p90: 107.3, p97_5: 113.2 },
      { age: 11, sex: "F", p2_5: 80.9, p10: 85.8, p25: 90.4, p50: 95.9, p75: 101.7, p90: 107.2, p97_5: 113.8 },
      { age: 12, sex: "M", p2_5: 85.9, p10: 90.5, p25: 94.8, p50: 99.9, p75: 105.3, p90: 110.5, p97_5: 116.6 },
      { age: 12, sex: "F", p2_5: 84.5, p10: 88.9, p25: 93, p50: 97.9, p75: 103.1, p90: 108, p97_5: 113.8 },
      { age: 13, sex: "M", p2_5: 88.3, p10: 92.9, p25: 97.3, p50: 102.5, p75: 108, p90: 113.2, p97_5: 119.4 },
      { age: 13, sex: "F", p2_5: 86.8, p10: 91.1, p25: 95.3, p50: 100.1, p75: 105.3, p90: 110.2, p97_5: 116 },
      { age: 14, sex: "M", p2_5: 90.5, p10: 95.2, p25: 99.6, p50: 104.8, p75: 110.3, p90: 115.6, p97_5: 121.9 },
      { age: 14, sex: "F", p2_5: 88.6, p10: 92.9, p25: 97, p50: 101.8, p75: 106.9, p90: 111.8, p97_5: 117.6 },
      { age: 15, sex: "M", p2_5: 93.2, p10: 97.9, p25: 102.5, p50: 107.8, p75: 113.5, p90: 119, p97_5: 125.5 },
      { age: 15, sex: "F", p2_5: 90.5, p10: 94.7, p25: 98.8, p50: 103.5, p75: 108.5, p90: 113.4, p97_5: 119.1 },
      { age: 16, sex: "M", p2_5: 95.6, p10: 100.3, p25: 104.9, p50: 110.3, p75: 116.1, p90: 121.6, p97_5: 128.3 },
      { age: 16, sex: "F", p2_5: 92.4, p10: 96.6, p25: 100.5, p50: 105.2, p75: 110.2, p90: 115, p97_5: 120.7 },
      { age: 17, sex: "M", p2_5: 98, p10: 102.8, p25: 107.4, p50: 112.8, p75: 118.6, p90: 124.2, p97_5: 131 },
      { age: 17, sex: "F", p2_5: 94.6, p10: 98.6, p25: 102.5, p50: 107, p75: 111.9, p90: 116.5, p97_5: 122.1 },
      { age: 18, sex: "M", p2_5: 100.6, p10: 105.5, p25: 110.1, p50: 115.6, p75: 121.5, p90: 127.2, p97_5: 134 },
      { age: 18, sex: "F", p2_5: 95.9, p10: 100, p25: 103.8, p50: 108.3, p75: 113.1, p90: 117.8, p97_5: 123.4 },
      // Add more rows for other ages
    ];

    function interpolatePercentile(size, row) {
      const points = [
        { p: 2.5, v: row.p2_5 },
        { p: 10, v: row.p10 },
        { p: 25, v: row.p25 },
        { p: 50, v: row.p50 },
        { p: 75, v: row.p75 },
        { p: 90, v: row.p90 },
        { p: 97.5, v: row.p97_5 },
      ];
      for (let i = 0; i < points.length - 1; i++) {
        const a = points[i], b = points[i + 1];
        if (size >= a.v && size <= b.v) {
          const ratio = (size - a.v) / (b.v - a.v);
          return (1 - ratio) * a.p + ratio * b.p;
        }
      }
      if (size < points[0].v) return "< 2.5";
      if (size > points[points.length - 1].v) return "> 97.5";
      return "Unknown";
    }

    function calculate() {
      const age = parseInt(document.getElementById("age").value);
      const sex = document.getElementById("sex").value;
      const size = parseFloat(document.getElementById("size").value);

      const match = normativeData.find(row => row.age === age && row.sex === sex);
      if (!match) {
        document.getElementById("output").textContent = "No data for this age and sex.";
        return;
      }

      const percentile = interpolatePercentile(size, match);
      document.getElementById("output").textContent = `Estimated Percentile: ${percentile}`;

      drawChart(match, size);
    }

    function drawChart(row, value) {
      const ctx = document.getElementById('chart').getContext('2d');
      if (window.chart) window.chart.destroy();
      window.chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['2.5%', '10%', '25%', '50%', '75%', '90%', '97.5%'],
          datasets: [
            {
              label: 'Kidney Size (cm)',
              data: [row.p2_5, row.p10, row.p25, row.p50, row.p75, row.p90, row.p97_5],
              borderColor: 'blue',
              fill: false
            },
            {
              label: 'Your Kidney Size',
              data: Array(7).fill(null).map((_, i) => i === 3 ? value : null),
              borderColor: 'red',
              pointBackgroundColor: 'red',
              borderWidth: 2,
              pointRadius: 6,
              type: 'scatter'
            }
          ]
        },
        options: {
          scales: { y: { beginAtZero: false } },
          plugins: { legend: { position: 'bottom' } }
        }
      });
    }
  </script>
</body>
</html>
